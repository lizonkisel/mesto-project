(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function o(e,t){t.querySelector(".form__button-submit").textContent=!0===e?"Сохранение...":t===y?"Создать":"Сохранить"}var r={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button-submit",inactiveButtonClass:"form__button-submit_disabled",errorClass:"form__item_invalid"};function c(e,t,n){var o=t.querySelector(e.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(n)?(o.classList.remove(e.inactiveButtonClass),o.disabled=!1):(o.classList.add(e.inactiveButtonClass),o.disabled=!0)}function a(e,t,n){var o=t.querySelector(".".concat(n.name,"-error")),r=n.validationMessage;n.validity.valid?(n.classList.remove(e.errorClass),o.textContent=""):(n.classList.add(e.errorClass),o.textContent=r)}var i="https://nomoreparties.co/v1/plus-cohort7/",u="ecd6f0c2-01ba-4d99-a774-de79c1d44e1d",l="application/json",s=document.querySelector(".popup_photo"),d=s.querySelector(".popup__image"),m=s.querySelector(".popup__title"),f=document.querySelector(".popup_edit-profile"),_=f.querySelector(".form"),p=f.querySelector(".form__item_type_name"),v=f.querySelector(".form__item_type_work"),h=Array.from(f.querySelectorAll(r.inputSelector)),y=document.querySelector(".popup_new-place"),S=y.querySelector(".form"),q=y.querySelector(".form__item_type_image"),k=y.querySelector(".form__item_type_title"),b=Array.from(S.querySelectorAll(r.inputSelector)),E=document.querySelector(".popup_delete-card"),L=E.querySelector(".form"),C=document.querySelector(".popup_edit-profile-photo"),g=C.querySelector(".form"),j=g.querySelector(".form__item_type_user-photo"),A=document.querySelector(".profile__avatar");var x=document.querySelector(".profile__name"),T=document.querySelector(".profile__description");function P(e){x.textContent=e.name,T.textContent=e.about}function z(e,t){e.src=t}var D=document.querySelector(".elements");function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=B(e,t);D.prepend(n)}function B(t,n){var o=document.querySelector("#place-template").content.querySelector(".element").cloneNode(!0);o.querySelector(".element__title").textContent=t.name,o.setAttribute("data-card-id",t._id);var r=o.querySelector(".element__image");r.src=t.link,r.alt=t.name,r.addEventListener("click",(function(n){var o,r;o=t.link,r=t.name,function(e){e.textContent=""}(m),function(e,t){d.setAttribute("src",e),d.setAttribute("alt",t)}(o,r),function(e){m.insertAdjacentText("afterbegin",e)}(r),e(s)})),o.querySelector(".element__like-amount").textContent=t.likes.length;var c=o.querySelector(".element__like");c.addEventListener("click",(function(){!function(e,t){e.classList.toggle("element__like_active"),e.classList.contains("element__like_active")?function(e){var t=e._id;return fetch("".concat(i,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:u}}).then((function(e){return e.ok?e.json():Promise.reject(e)}))}(t).then((function(e){N(e)})).catch((function(e){console.log(e)})):function(e){var t=e._id;return fetch("".concat(i,"cards/likes/").concat(t),{method:"DELETE",headers:{authorization:u}}).then((function(e){return e.ok?e.json():Promise.reject(e)}))}(t).then((function(e){N(e)})).catch((function(e){console.log(e)}))}(c,t)})),function(e,t,n){t=t._id,e.likes.some((function(e){e._id===t&&n.classList.add("element__like_active")}))}(t,n,c);var a=o.querySelector(".element__delete");return t.owner.name===x.textContent?a.addEventListener("click",(function(){e(E),E.setAttribute("data-card-id",t._id)})):a.remove(),o}function N(e){document.querySelector(".element[data-card-id='".concat(e._id,"']")).querySelector(".element__like-amount").textContent=e.likes.length}var O,J=document.querySelector(".profile__edit-button"),G=document.querySelector(".profile__add-button"),H=document.querySelector(".profile__avatar-mask"),I=Array.from(document.querySelectorAll(".popup"));fetch("".concat(i,"/users/me"),{method:"GET",headers:{authorization:u,"Content-Type":l}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){P(e),z(A,e.avatar),fetch("".concat(i,"/cards"),{method:"GET",headers:{authorization:u}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(t){return t.forEach((function(t){w(t,e)}))})).catch((function(e){console.log("Ошибка ".concat(e))}))})).catch((function(e){console.log("Ошибка ".concat(e))})),J.addEventListener("click",(function(){p.value=x.textContent,v.value=T.textContent,h.forEach((function(e){a(r,f,e)})),c(r,f,h),e(f)})),G.addEventListener("click",(function(){e(y)})),H.addEventListener("click",(function(){e(C)})),_.addEventListener("submit",(function(e){var n,r;e.preventDefault(),o(!0,f),(n=p,r=v,fetch("".concat(i,"/users/me"),{method:"PATCH",headers:{authorization:u,"Content-Type":l},body:JSON.stringify({name:n.value,about:r.value})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){P(e),t(f),o(!1,f)})).catch((function(e){return console.log("Ошибка ".concat(e))}))})),S.addEventListener("submit",(function(e){var n,a;e.preventDefault(),o(!0,y),(n=q,a=k,fetch("".concat(i,"/cards"),{method:"POST",headers:{authorization:u,"Content-Type":l},body:JSON.stringify({name:a.value,link:n.value})}).then((function(e){return e.ok?e.json():Promise.reject(e)}))).then((function(e){w(e),t(y),S.reset(),o(!1,y),c(r,S,b)})).catch((function(e){return console.log("Ошибка:".concat(e.status," ").concat(e.statusText))}))})),g.addEventListener("submit",(function(e){var n;e.preventDefault(),o(!0,C),(n=j.value,fetch("".concat(i,"users/me/avatar"),{method:"PATCH",headers:{authorization:u,"Content-Type":l},body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject(e)}))).then((function(e){z(A,e.avatar),t(C),g.reset(),o(!1,C),c(r,g,[j])})).catch((function(e){console.log(e)}))})),L.addEventListener("submit",(function(e){e.preventDefault();var n,o=E.dataset.cardId;(n=o,fetch("".concat(i,"cards/").concat(n),{method:"DELETE",headers:{authorization:u}}).then((function(e){return e.ok?e.json():Promise.reject(e)}))).catch((function(e){console.log("Ошибка:".concat(e.status," ").concat(e.statusText))})),document.querySelector("[data-card-id='".concat(o,"']")).remove(),t(E)})),I.forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_opened")&&t(e),n.target.classList.contains("popup__button-close")&&t(e)}))})),O=r,Array.from(document.querySelectorAll(O.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector));c(e,t,n),n.forEach((function(o){o.addEventListener("input",(function(r){a(e,t,o),c(e,t,n)}))}))}(O,e),e.addEventListener("submit",(function(e){e.preventDefault()}))}))})();