(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function o(e,t){t.querySelector(".form__button-submit").textContent=!0===e?"Сохранение...":t===_?"Создать":"Сохранить"}var r={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button-submit",inactiveButtonClass:"form__button-submit_disabled",errorClass:"form__item_invalid"};function c(e,t,n){var o=t.querySelector(e.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(n)?(o.classList.remove(e.inactiveButtonClass),o.disabled=!1):(o.classList.add(e.inactiveButtonClass),o.disabled=!0)}function a(e,t,n){var o=t.querySelector(".".concat(n.name,"-error")),r=n.validationMessage;n.validity.valid?(n.classList.remove(e.errorClass),o.textContent=""):(n.classList.add(e.errorClass),o.textContent=r)}var i=document.querySelector(".popup_photo"),u=i.querySelector(".popup__image"),l=i.querySelector(".popup__title"),s=document.querySelector(".popup_edit-profile"),d=s.querySelector(".form"),f=s.querySelector(".form__item_type_name"),m=s.querySelector(".form__item_type_work"),p=Array.from(s.querySelectorAll(r.inputSelector)),_=document.querySelector(".popup_new-place"),y=_.querySelector(".form"),v=_.querySelector(".form__item_type_image"),h=_.querySelector(".form__item_type_title"),S=Array.from(y.querySelectorAll(r.inputSelector)),q=document.querySelector(".popup_delete-card"),b=q.querySelector(".form"),E=document.querySelector(".popup_edit-profile-photo"),L=E.querySelector(".form"),k=L.querySelector(".form__item_type_user-photo"),g=document.querySelector(".profile__avatar");var C=document.querySelector(".profile__name"),A=document.querySelector(".profile__description");function x(e){e.classList.toggle("element__like_active")}function T(e){document.querySelector(".element[data-card-id='".concat(e._id,"']")).querySelector(".element__like-amount").textContent=e.likes.length}var w="https://nomoreparties.co/v1/plus-cohort7/",z="ecd6f0c2-01ba-4d99-a774-de79c1d44e1d",D="application/json";function j(e){return e.ok?e.json():Promise.reject(e.status)}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var P,B=document.querySelector(".profile__edit-button"),I=document.querySelector(".profile__add-button"),N=document.querySelector(".profile__avatar-mask"),J=Array.from(document.querySelectorAll(".popup")),G=document.querySelector(".elements");function H(t,n,o){var r=function(t,n){var o=document.querySelector("#place-template").content.querySelector(".element").cloneNode(!0);o.querySelector(".element__title").textContent=t.name,o.setAttribute("data-card-id",t._id);var r=o.querySelector(".element__image");r.src=t.link,r.alt=t.name,r.addEventListener("click",(function(n){var o,r;o=t.link,r=t.name,function(e,t){u.setAttribute("src",e),u.setAttribute("alt",t)}(o,r),function(e){l.textContent=e}(r),e(i)})),o.querySelector(".element__like-amount").textContent=t.likes.length;var c=o.querySelector(".element__like");!function(e,t,n){t=t._id,e.likes.some((function(e){e._id===t&&n.classList.add("element__like_active")}))}(t,n,c);var a=o.querySelector(".element__delete");return t.owner.name===C.textContent?a.addEventListener("click",(function(){e(q),q.setAttribute("data-card-id",t._id)})):a.remove(),o}(t,n),c=r.querySelector(".element__like");c.addEventListener("click",(function(){return function(e,t){t.classList.contains("element__like_active")?function(e){var t=e._id;return fetch("".concat(w,"cards/likes/").concat(t),{method:"DELETE",headers:{authorization:z}}).then(j)}(e).then((function(e){x(t),T(e)})).catch((function(e){console.log(e)})):function(e){var t=e._id;return fetch("".concat(w,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:z}}).then(j)}(e).then((function(e){x(t),T(e)})).catch((function(e){console.log(e)}))}(t,c)})),"append"===o?G.append(r):G.prepend(r)}function M(e){C.textContent=e.name,A.textContent=e.about}function U(e,t){e.src=t}Promise.all([fetch("".concat(w,"/users/me"),{method:"GET",headers:{authorization:z,"Content-Type":D}}).then(j),fetch("".concat(w,"/cards"),{method:"GET",headers:{authorization:z}}).then(j)]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw r}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];M(r),U(g,r.avatar),c.forEach((function(e){H(e,r,"append")}))})).catch((function(e){console.log("Ошибка ".concat(e))})),B.addEventListener("click",(function(){f.value=C.textContent,m.value=A.textContent,p.forEach((function(e){a(r,s,e)})),c(r,s,p),e(s)})),I.addEventListener("click",(function(){e(_)})),N.addEventListener("click",(function(){e(E)})),d.addEventListener("submit",(function(e){var n,r;e.preventDefault(),o(!0,s),(n=f,r=m,fetch("".concat(w,"/users/me"),{method:"PATCH",headers:{authorization:z,"Content-Type":D},body:JSON.stringify({name:n.value,about:r.value})}).then(j)).then((function(e){M(e),t(s)})).catch((function(e){return console.log("Ошибка ".concat(e))})).finally((function(){o(!1,s)}))})),y.addEventListener("submit",(function(e){var n,a;e.preventDefault(),o(!0,_),(n=v,a=h,fetch("".concat(w,"/cards"),{method:"POST",headers:{authorization:z,"Content-Type":D},body:JSON.stringify({name:a.value,link:n.value})}).then(j)).then((function(e){H(e,e.owner,"prepend"),t(_),y.reset(),c(r,y,S)})).catch((function(e){return console.log("Ошибка:".concat(e.status," ").concat(e.statusText))})).finally((function(){o(!1,_)}))})),L.addEventListener("submit",(function(e){var n;e.preventDefault(),o(!0,E),(n=k.value,fetch("".concat(w,"users/me/avatar"),{method:"PATCH",headers:{authorization:z,"Content-Type":D},body:JSON.stringify({avatar:n})}).then(j)).then((function(e){U(g,e.avatar),t(E),L.reset(),c(r,L,[k])})).catch((function(e){console.log(e)})).finally((function(){o(!1,E)}))})),b.addEventListener("submit",(function(e){e.preventDefault();var n,o=q.dataset.cardId;(n=o,fetch("".concat(w,"cards/").concat(n),{method:"DELETE",headers:{authorization:z}}).then(j)).then((function(){document.querySelector("[data-card-id='".concat(o,"']")).remove(),t(q)})).catch((function(e){console.log("Ошибка:".concat(e.status," ").concat(e.statusText))}))})),J.forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_opened")&&t(e),n.target.classList.contains("popup__button-close")&&t(e)}))})),P=r,Array.from(document.querySelectorAll(P.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector));c(e,t,n),n.forEach((function(o){o.addEventListener("input",(function(r){a(e,t,o),c(e,t,n)}))}))}(P,e),e.addEventListener("submit",(function(e){e.preventDefault()}))}))})();