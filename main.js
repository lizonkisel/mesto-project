(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup_opened"))}function r(e,t){t.querySelector(".form__button-submit").textContent=!0===e?"Сохранение...":t===_?"Создать":"Сохранить"}e.d({},{s:()=>$});var c={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button-submit",inactiveButtonClass:"form__button-submit_disabled",errorClass:"form__item_invalid"};function a(e,t,n){var o=t.querySelector(e.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(n)?(o.classList.remove(e.inactiveButtonClass),o.disabled=!1):(o.classList.add(e.inactiveButtonClass),o.disabled=!0)}function i(e,t,n){var o=t.querySelector(".".concat(n.name,"-error")),r=n.validationMessage;n.validity.valid?(n.classList.remove(e.errorClass),o.textContent=""):(n.classList.add(e.errorClass),o.textContent=r)}var u=document.querySelector(".popup_photo"),l=u.querySelector(".popup__image"),s=u.querySelector(".popup__title"),d=document.querySelector(".popup_edit-profile"),f=d.querySelector(".form"),m=d.querySelector(".form__item_type_name"),p=d.querySelector(".form__item_type_work"),y=Array.from(d.querySelectorAll(c.inputSelector)),_=document.querySelector(".popup_new-place"),v=_.querySelector(".form"),h=_.querySelector(".form__item_type_image"),S=_.querySelector(".form__item_type_title"),q=Array.from(v.querySelectorAll(c.inputSelector)),b=document.querySelector(".popup_delete-card"),E=b.querySelector(".form"),L=document.querySelector(".popup_edit-profile-photo"),g=L.querySelector(".form"),k=g.querySelector(".form__item_type_user-photo"),C=document.querySelector(".profile__avatar");var A=document.querySelector(".profile__name"),T=document.querySelector(".profile__description");function x(e){e.classList.toggle("element__like_active")}function w(e){document.querySelector(".element[data-card-id='".concat(e._id,"']")).querySelector(".element__like-amount").textContent=e.likes.length}var O="https://nomoreparties.co/v1/plus-cohort7/",j="ecd6f0c2-01ba-4d99-a774-de79c1d44e1d",z="application/json";function P(e){return e.ok?e.json():Promise.reject(e.status)}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var B,I,N=document.querySelector(".profile__edit-button"),J=document.querySelector(".profile__add-button"),G=document.querySelector(".profile__avatar-mask"),H=Array.from(document.querySelectorAll(".popup")),M=document.querySelector(".elements");function U(e,n,o){var r=function(e,n){var o=document.querySelector("#place-template").content.querySelector(".element").cloneNode(!0);o.querySelector(".element__title").textContent=e.name,o.setAttribute("data-card-id",e._id);var r=o.querySelector(".element__image");r.src=e.link,r.alt=e.name,r.addEventListener("click",(function(n){var o,r;o=e.link,r=e.name,function(e,t){l.setAttribute("src",e),l.setAttribute("alt",t)}(o,r),function(e){s.textContent=e}(r),t(u)})),o.querySelector(".element__like-amount").textContent=e.likes.length;var c=o.querySelector(".element__like");c.addEventListener("click",(function(){return $(e,c)})),function(e,t,n){e.likes.some((function(e){e._id===t&&n.classList.add("element__like_active")}))}(e,n,c);var a=o.querySelector(".element__delete");return e.owner._id===n?a.addEventListener("click",(function(){t(b),b.setAttribute("data-card-id",e._id)})):a.remove(),o}(e,n);"append"===o?M.append(r):M.prepend(r)}function $(e,t){t.classList.contains("element__like_active")?function(e){var t=e._id;return fetch("".concat(O,"cards/likes/").concat(t),{method:"DELETE",headers:{authorization:j}}).then(P)}(e).then((function(e){x(t),w(e)})).catch((function(e){console.log(e)})):function(e){var t=e._id;return fetch("".concat(O,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:j}}).then(P)}(e).then((function(e){x(t),w(e)})).catch((function(e){console.log(e)}))}function F(e){A.textContent=e.name,T.textContent=e.about}function K(e,t){e.src=t}Promise.all([fetch("".concat(O,"/users/me"),{method:"GET",headers:{authorization:j,"Content-Type":z}}).then(P),fetch("".concat(O,"/cards"),{method:"GET",headers:{authorization:j}}).then(P)]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);a=!0);}catch(e){i=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw r}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];B=r._id,F(r),K(C,r.avatar),c.forEach((function(e){U(e,B,"append")}))})).catch((function(e){console.log("Ошибка ".concat(e))})),N.addEventListener("click",(function(){m.value=A.textContent,p.value=T.textContent,y.forEach((function(e){i(c,d,e)})),a(c,d,y),t(d)})),J.addEventListener("click",(function(){t(_)})),G.addEventListener("click",(function(){t(L)})),f.addEventListener("submit",(function(e){var t,o;e.preventDefault(),r(!0,d),(t=m,o=p,fetch("".concat(O,"/users/me"),{method:"PATCH",headers:{authorization:j,"Content-Type":z},body:JSON.stringify({name:t.value,about:o.value})}).then(P)).then((function(e){F(e),n(d)})).catch((function(e){return console.log("Ошибка ".concat(e))})).finally((function(){r(!1,d)}))})),v.addEventListener("submit",(function(e){var t,o;e.preventDefault(),r(!0,_),(t=h,o=S,fetch("".concat(O,"/cards"),{method:"POST",headers:{authorization:j,"Content-Type":z},body:JSON.stringify({name:o.value,link:t.value})}).then(P)).then((function(e){U(e,B,"prepend"),n(_),v.reset(),a(c,v,q)})).catch((function(e){return console.log("Ошибка:".concat(e.status," ").concat(e.statusText))})).finally((function(){r(!1,_)}))})),g.addEventListener("submit",(function(e){var t;e.preventDefault(),r(!0,L),(t=k.value,fetch("".concat(O,"users/me/avatar"),{method:"PATCH",headers:{authorization:j,"Content-Type":z},body:JSON.stringify({avatar:t})}).then(P)).then((function(e){K(C,e.avatar),n(L),g.reset(),a(c,g,[k])})).catch((function(e){console.log(e)})).finally((function(){r(!1,L)}))})),E.addEventListener("submit",(function(e){e.preventDefault();var t,o=b.dataset.cardId;(t=o,fetch("".concat(O,"cards/").concat(t),{method:"DELETE",headers:{authorization:j}}).then(P)).then((function(){document.querySelector("[data-card-id='".concat(o,"']")).remove(),n(b)})).catch((function(e){console.log("Ошибка:".concat(e.status," ").concat(e.statusText))}))})),H.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&n(e),t.target.classList.contains("popup__button-close")&&n(e)}))})),I=c,Array.from(document.querySelectorAll(I.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector));a(e,t,n),n.forEach((function(o){o.addEventListener("input",(function(r){i(e,t,o),a(e,t,n)}))}))}(I,e),e.addEventListener("submit",(function(e){e.preventDefault()}))}))})();