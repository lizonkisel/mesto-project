(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}function o(e,t){t.querySelector(".form__button-submit").textContent=!0===e?"Сохранение...":t===_?"Создать":"Сохранить"}var r={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button-submit",inactiveButtonClass:"form__button-submit_disabled",errorClass:"form__item_invalid"};function c(e,t,n){var o=t.querySelector(e.submitButtonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(n)?(o.classList.remove(e.inactiveButtonClass),o.disabled=!1):(o.classList.add(e.inactiveButtonClass),o.disabled=!0)}function a(e,t,n){var o=t.querySelector(".".concat(n.name,"-error")),r=n.validationMessage;n.validity.valid?(n.classList.remove(e.errorClass),o.textContent=""):(n.classList.add(e.errorClass),o.textContent=r)}var i=document.querySelector(".popup_photo"),u=i.querySelector(".popup__image"),l=i.querySelector(".popup__title"),s=document.querySelector(".popup_edit-profile"),d=s.querySelector(".form"),f=s.querySelector(".form__item_type_name"),m=s.querySelector(".form__item_type_work"),p=Array.from(s.querySelectorAll(r.inputSelector)),_=document.querySelector(".popup_new-place"),v=_.querySelector(".form"),y=_.querySelector(".form__item_type_image"),h=_.querySelector(".form__item_type_title"),S=Array.from(v.querySelectorAll(r.inputSelector)),q=document.querySelector(".popup_delete-card"),b=q.querySelector(".form"),E=document.querySelector(".popup_edit-profile-photo"),L=E.querySelector(".form"),k=L.querySelector(".form__item_type_user-photo"),C=document.querySelector(".profile__avatar");var g=document.querySelector(".profile__name"),A=document.querySelector(".profile__description");function x(e){e.classList.toggle("element__like_active")}function T(e){document.querySelector(".element[data-card-id='".concat(e._id,"']")).querySelector(".element__like-amount").textContent=e.likes.length}var z="https://nomoreparties.co/v1/plus-cohort7/",w="ecd6f0c2-01ba-4d99-a774-de79c1d44e1d",D="application/json";function B(e){return e.ok?e.json():Promise.reject(e.status)}var P,N=document.querySelector(".profile__edit-button"),O=document.querySelector(".profile__add-button"),j=document.querySelector(".profile__avatar-mask"),J=Array.from(document.querySelectorAll(".popup")),G=document.querySelector(".elements");function H(t,n,o){var r=function(t,n){var o=document.querySelector("#place-template").content.querySelector(".element").cloneNode(!0);o.querySelector(".element__title").textContent=t.name,o.setAttribute("data-card-id",t._id);var r=o.querySelector(".element__image");r.src=t.link,r.alt=t.name,r.addEventListener("click",(function(n){var o,r;o=t.link,r=t.name,function(e,t){u.setAttribute("src",e),u.setAttribute("alt",t)}(o,r),function(e){l.textContent=e}(r),e(i)})),o.querySelector(".element__like-amount").textContent=t.likes.length;var c=o.querySelector(".element__like");!function(e,t,n){t=t._id,e.likes.some((function(e){e._id===t&&n.classList.add("element__like_active")}))}(t,n,c);var a=o.querySelector(".element__delete");return t.owner.name===g.textContent?a.addEventListener("click",(function(){e(q),q.setAttribute("data-card-id",t._id)})):a.remove(),o}(t,n),c=r.querySelector(".element__like");c.addEventListener("click",(function(){return function(e,t){t.classList.contains("element__like_active")?function(e){var t=e._id;return fetch("".concat(z,"cards/likes/").concat(t),{method:"DELETE",headers:{authorization:w}}).then(B)}(e).then((function(e){x(t),T(e)})).catch((function(e){console.log(e)})):function(e){var t=e._id;return fetch("".concat(z,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:w}}).then(B)}(e).then((function(e){x(t),T(e)})).catch((function(e){console.log(e)}))}(t,c)})),"append"===o?G.append(r):G.prepend(r)}function I(e){g.textContent=e.name,A.textContent=e.about}function M(e,t){e.src=t}fetch("".concat(z,"/users/me"),{method:"GET",headers:{authorization:w,"Content-Type":D}}).then(B).then((function(e){I(e),M(C,e.avatar),fetch("".concat(z,"/cards"),{method:"GET",headers:{authorization:w}}).then(B).then((function(t){return t.forEach((function(t){H(t,e,"append")}))})).catch((function(e){console.log("Ошибка ".concat(e))}))})).catch((function(e){console.log("Ошибка ".concat(e))})),N.addEventListener("click",(function(){f.value=g.textContent,m.value=A.textContent,p.forEach((function(e){a(r,s,e)})),c(r,s,p),e(s)})),O.addEventListener("click",(function(){e(_)})),j.addEventListener("click",(function(){e(E)})),d.addEventListener("submit",(function(e){var n,r;e.preventDefault(),o(!0,s),(n=f,r=m,fetch("".concat(z,"/users/me"),{method:"PATCH",headers:{authorization:w,"Content-Type":D},body:JSON.stringify({name:n.value,about:r.value})}).then(B)).then((function(e){I(e),t(s)})).catch((function(e){return console.log("Ошибка ".concat(e))})).finally((function(){o(!1,s)}))})),v.addEventListener("submit",(function(e){var n,a;e.preventDefault(),o(!0,_),(n=y,a=h,fetch("".concat(z,"/cards"),{method:"POST",headers:{authorization:w,"Content-Type":D},body:JSON.stringify({name:a.value,link:n.value})}).then(B)).then((function(e){H(e,e.owner,"prepend"),t(_),v.reset(),c(r,v,S)})).catch((function(e){return console.log("Ошибка:".concat(e.status," ").concat(e.statusText))})).finally((function(){o(!1,_)}))})),L.addEventListener("submit",(function(e){var n;e.preventDefault(),o(!0,E),(n=k.value,fetch("".concat(z,"users/me/avatar"),{method:"PATCH",headers:{authorization:w,"Content-Type":D},body:JSON.stringify({avatar:n})}).then(B)).then((function(e){M(C,e.avatar),t(E),L.reset(),c(r,L,[k])})).catch((function(e){console.log(e)})).finally((function(){o(!1,E)}))})),b.addEventListener("submit",(function(e){e.preventDefault();var n,o=q.dataset.cardId;(n=o,fetch("".concat(z,"cards/").concat(n),{method:"DELETE",headers:{authorization:w}}).then(B)).then((function(){document.querySelector("[data-card-id='".concat(o,"']")).remove(),t(q)})).catch((function(e){console.log("Ошибка:".concat(e.status," ").concat(e.statusText))}))})),J.forEach((function(e){e.addEventListener("mousedown",(function(n){n.target.classList.contains("popup_opened")&&t(e),n.target.classList.contains("popup__button-close")&&t(e)}))})),P=r,Array.from(document.querySelectorAll(P.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector));c(e,t,n),n.forEach((function(o){o.addEventListener("input",(function(r){a(e,t,o),c(e,t,n)}))}))}(P,e),e.addEventListener("submit",(function(e){e.preventDefault()}))}))})();